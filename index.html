<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relat√≥rio de Campo</title>

  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#432874" />

  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- TOAST CONTAINER -->
  <div id="toast-container" class="toast-container"></div>

  <div id="app">

    <!-- HEADER -->
    <header class="app-header">
      <div class="app-title">
        <span class="logo-dot"></span>
        <span id="header-title">Relat√≥rio de Campo</span>
      </div>
      <div class="header-actions">
        <button id="btn-install-app" class="btn-install" title="Instalar aplicativo" style="display: none;">
          üì± Instalar
        </button>
        <button id="btn-theme-toggle" class="icon-button" title="Tema claro/escuro">üåì</button>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main id="app-main">
      <!-- VIEW: LOGIN -->
      <section class="view active" data-view="login">
        <div class="card card-centered">
          <h1 class="title">Bem-vindo</h1>
          <p class="subtitle">Controle seu relat√≥rio de campo de forma simples.</p>

          <div class="tabs tabs-auth">
            <button class="tab-button active" data-auth-tab="login">Entrar</button>
            <button class="tab-button" data-auth-tab="signup">Criar conta</button>
          </div>

          <!-- Login -->
          <form id="form-login" class="form form-auth">
            <label>
              E-mail
              <input type="email" id="login-email" required />
            </label>
            <label>
              Senha
              <input type="password" id="login-password" required />
            </label>
            <button type="submit" class="btn-primary">Entrar</button>
          </form>

          <!-- Cadastro -->
          <form id="form-signup" class="form form-auth hidden">
            <label>
              Nome
              <input type="text" id="signup-nome" required />
            </label>
            <label>
              Congrega√ß√£o
              <input type="text" id="signup-congregacao" required />
            </label>
            <label>
              Tipo de servi√ßo
              <select id="signup-tipo" required>
                <option value="publicador">Publicador</option>
                <option value="auxiliar">Pioneiro Auxiliar</option>
                <option value="regular">Pioneiro Regular</option>
              </select>
            </label>
            <label>
              E-mail
              <input type="email" id="signup-email" required />
            </label>
            <label>
              Senha
              <input type="password" id="signup-password" required />
            </label>
            <button type="submit" class="btn-primary">Criar conta</button>
          </form>
        </div>
      </section>

      <!-- VIEW: DASHBOARD -->
      <section class="view" data-view="dashboard">
        <div class="card card-top">
          <h2>Resumo do m√™s</h2>
          <p id="dashboard-mes"></p>
          <div class="grid grid-3">
            <div class="stat">
              <span class="stat-label">Horas</span>
              <span class="stat-value" id="stat-horas">0h</span>
            </div>
            <div class="stat">
              <span class="stat-label">Meta</span>
              <span class="stat-value" id="stat-meta">‚Äì</span>
            </div>
            <div class="stat">
              <span class="stat-label">% Progresso</span>
              <span class="stat-value" id="stat-progresso">0%</span>
            </div>
          </div>
          <p id="dashboard-comparativo" class="text-muted small"></p>
        </div>

        <div class="card">
          <h3>A√ß√µes r√°pidas</h3>
          <div class="grid grid-2">
            <button class="btn-secondary" id="btn-open-add-entry">Adicionar lan√ßamento</button>
            <button class="btn-secondary" id="btn-start-timer">Iniciar servi√ßo (timer)</button>
            <button class="btn-secondary" id="btn-registrar-revisita">Registrar revisita</button>
            <button class="btn-secondary" id="btn-registrar-estudo">Registrar estudo</button>
            <button class="btn-secondary" id="btn-configurar-meta">‚öôÔ∏è Configurar meta</button>
            <button class="btn-secondary" id="btn-encerrar-meta" style="display: none;">üèÅ Encerrar meta</button>
          </div>
          <p id="timer-status" class="text-muted small"></p>
          <p id="meta-status" class="text-muted small"></p>
        </div>

        <div class="card">
          <div class="card-header-collapsible collapsed" id="toggle-lancamentos">
            <h3>Lan√ßamentos</h3>
            <span class="collapse-icon">‚ñº</span>
          </div>
          <div id="lista-lancamentos" class="collapsible-content collapsed"></div>
        </div>
      </section>

      <!-- VIEW: LAN√áAMENTO -->
      <section class="view" data-view="lancamento">
        <div class="card card-top">
          <h2>Novo lan√ßamento</h2>
          <form id="form-lancamento" class="form">
            <label>
              Data
              <input type="date" id="lan-data" required />
            </label>
            <div class="grid grid-2">
              <label>
                Horas
                <input type="number" id="lan-horas" min="0" value="0" required />
              </label>
              <label>
                Minutos
                <input type="number" id="lan-minutos" min="0" max="59" value="0" required />
              </label>
            </div>
            <label>
              Modalidade
              <select id="lan-modalidade" required></select>
            </label>
            <div id="lan-pessoa-info" class="text-muted small" style="margin: -8px 0 8px 0; display: none;"></div>
            <label>
              Observa√ß√µes
              <textarea id="lan-obs" rows="2" placeholder="Anota√ß√µes (opcional)"></textarea>
            </label>
            <input type="hidden" id="lan-pessoa-id" />
            <input type="hidden" id="lan-pessoa-nome" />
            <button type="submit" class="btn-primary">Salvar lan√ßamento</button>
          </form>
        </div>
      </section>

      <!-- VIEW: REVISITAS -->
      <section class="view" data-view="revisitas">
        <div class="card card-top">
          <h2>Revisitas</h2>
          <button id="btn-add-revisita" class="btn-primary btn-full">Adicionar revisita</button>
        </div>
        <div class="card">
          <ul id="lista-revisitas" class="list-simple"></ul>
        </div>
      </section>

      <!-- VIEW: ESTUDOS -->
      <section class="view" data-view="estudos">
        <div class="card card-top">
          <h2>Estudos b√≠blicos</h2>
          <button id="btn-add-estudo" class="btn-primary btn-full">Adicionar estudo</button>
        </div>
        <div class="card">
          <ul id="lista-estudos" class="list-simple"></ul>
        </div>
      </section>

      <!-- VIEW: METAS -->
      <section class="view" data-view="metas">
        <div class="card card-top">
          <h2>Metas de servi√ßo</h2>
          <p id="metas-tipo"></p>
          <form id="form-metas" class="form">
            <div id="metas-publicador" class="metas-bloco">
              <label>
                Meta mensal (opcional, em horas)
                <input type="number" id="meta-pub-mensal" min="0" />
              </label>
            </div>

            <div id="metas-auxiliar" class="metas-bloco">
              <label>
                Meta deste m√™s (horas)
                <input type="number" id="meta-aux-mensal" min="0" />
              </label>
            </div>

            <div id="metas-regular" class="metas-bloco">
              <label>
                Tipo de meta
                <select id="meta-reg-tipo">
                  <option value="mensal">Mensal</option>
                  <option value="anual">Anual</option>
                </select>
              </label>
              <label id="lbl-meta-reg-mensal">
                Meta mensal (horas)
                <input type="number" id="meta-reg-mensal" min="0" />
              </label>
              <label id="lbl-meta-reg-anual" class="hidden">
                Meta anual (horas)
                <input type="number" id="meta-reg-anual" min="0" />
              </label>
            </div>

            <button type="submit" class="btn-primary">Salvar metas</button>
          </form>
        </div>
      </section>

      <!-- VIEW: RELAT√ìRIO -->
      <section class="view" data-view="relatorio">
        <div class="card card-top">
          <h2>Relat√≥rio do m√™s</h2>
          <form id="form-relatorio" class="form">
            <div class="grid grid-2">
              <label>
                M√™s
                <select id="rel-mes" required>
                  <option value="1">Janeiro</option>
                  <option value="2">Fevereiro</option>
                  <option value="3">Mar√ßo</option>
                  <option value="4">Abril</option>
                  <option value="5">Maio</option>
                  <option value="6">Junho</option>
                  <option value="7">Julho</option>
                  <option value="8">Agosto</option>
                  <option value="9">Setembro</option>
                  <option value="10">Outubro</option>
                  <option value="11">Novembro</option>
                  <option value="12">Dezembro</option>
                </select>
              </label>
              <label>
                Ano
                <select id="rel-ano" required></select>
              </label>
            </div>
            <button type="button" id="btn-gerar-relatorio" class="btn-secondary">Gerar</button>
          </form>
        </div>

        <div class="card hidden" id="relatorio-resultado">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
            <h3 style="margin: 0;">Dados do relat√≥rio</h3>
            <button type="button" id="btn-alterar-mes" class="btn-secondary" style="padding: 6px 12px; font-size: 0.85rem;">üìÖ Alterar m√™s</button>
          </div>
          <pre id="relatorio-preview" class="rel-preview"></pre>
          <div class="grid grid-2">
            <button id="btn-enviar-whatsapp" class="btn-primary">üì± WhatsApp Pessoal</button>
            <button id="btn-enviar-relatorio-anciao" class="btn-primary">üì§ Enviar ao Anci√£o</button>
          </div>
        </div>
      </section>

      <!-- VIEW: CONFIGURA√á√ïES -->
      <section class="view" data-view="config">
        <div class="card card-top">
          <h2>Configura√ß√µes</h2>
          <form id="form-config" class="form">
            <label>
              Nome
              <input type="text" id="cfg-nome" required />
            </label>
            <label>
              Congrega√ß√£o
              <input type="text" id="cfg-congregacao" required />
            </label>
            <label>
              Tipo de servi√ßo
              <select id="cfg-tipo" required>
                <option value="publicador">Publicador</option>
                <option value="auxiliar">Pioneiro Auxiliar</option>
                <option value="regular">Pioneiro Regular</option>
              </select>
            </label>
            <button type="submit" class="btn-primary">Salvar configura√ß√µes</button>
          </form>
        </div>

        <div class="card">
          <h3>Anci√£os</h3>
          <p class="text-muted small">Gerencie os anci√£os respons√°veis por receber relat√≥rios.</p>
          <ul id="lista-anciaos" class="list-simple"></ul>
          <button id="btn-add-anciao" class="btn-secondary" style="width: 100%; margin-top: 12px;">+ Adicionar anci√£o</button>
        </div>

        <div class="card">
          <button id="btn-logout" class="btn-secondary" style="width: 100%;">üö™ Sair</button>
        </div>
      </section>

      <!-- VIEW: AJUDA -->
      <section class="view" data-view="ajuda">
        <h2 class="page-title">‚ùì Ajuda</h2>
        <p class="page-subtitle">Aprenda a usar todas as funcionalidades do aplicativo</p>

        <div class="card">
          <h3>üè† In√≠cio (Dashboard)</h3>
          <p class="text-muted small">Aqui voc√™ visualiza o resumo do m√™s atual:</p>
          <ul class="help-list">
            <li><strong>Horas:</strong> Total de horas e minutos trabalhados no m√™s</li>
            <li><strong>Meta:</strong> Meta de horas configurada para seu tipo de servi√ßo</li>
            <li><strong>Progresso:</strong> Percentual de conclus√£o da meta</li>
            <li><strong>Timer:</strong> Se houver um cron√¥metro ativo, ele aparecer√° aqui com tempo correndo em tempo real</li>
          </ul>
          <p class="text-muted small">üí° <strong>Dica:</strong> Clique no bot√£o <strong>"‚è±Ô∏è Iniciar Cron√¥metro"</strong> para come√ßar a contar suas horas rapidamente!</p>
        </div>

        <div class="card">
          <h3>‚è±Ô∏è Cron√¥metro</h3>
          <p class="text-muted small">O cron√¥metro √© a forma mais pr√°tica de registrar suas horas de campo:</p>
          <ul class="help-list">
            <li><strong>Iniciar:</strong> Clique no bot√£o verde "‚è±Ô∏è Iniciar Cron√¥metro" e selecione as modalidades (Campo, Revisitas, Estudos, V√≠deos, etc.)</li>
            <li><strong>Pausar:</strong> Clique em "‚è∏Ô∏è Pausar" para interromper temporariamente</li>
            <li><strong>Retomar:</strong> Clique em "‚ñ∂Ô∏è Retomar" para continuar de onde parou</li>
            <li><strong>Encerrar:</strong> Clique em "‚èπÔ∏è Encerrar" para finalizar e salvar o tempo</li>
            <li><strong>Minimizar:</strong> Clique no "X" no canto superior direito para fechar a janela do timer (ele continua rodando em segundo plano)</li>
          </ul>
          <p class="text-muted small">üí° <strong>Dica:</strong> O cron√¥metro continua rodando mesmo se voc√™ fechar o aplicativo! Voc√™ receber√° notifica√ß√µes com op√ß√µes de pausar ou encerrar.</p>
        </div>

        <div class="card">
          <h3>üîÅ Revisitas e üìñ Estudos</h3>
          <p class="text-muted small">Quando voc√™ seleciona "Revisitas" ou "Estudos" no cron√¥metro ou lan√ßamento:</p>
          <ul class="help-list">
            <li><strong>Selecionar pessoa:</strong> Escolha o nome da pessoa na lista suspensa</li>
            <li><strong>Confirma√ß√£o de contato:</strong> Ao encerrar, o app pergunta se voc√™ conseguiu contatar a pessoa</li>
            <li><strong>Se SIM:</strong> A visita √© registrada na aba correspondente (Revisitas ou Estudos)</li>
            <li><strong>Se N√ÉO:</strong> Apenas as horas s√£o contabilizadas como "Campo" (a modalidade Revisitas/Estudos √© removida automaticamente)</li>
          </ul>
          <p class="text-muted small">üí° <strong>Dica:</strong> Nas abas "üîÅ Revisitas" e "üìñ Estudos" voc√™ pode adicionar novos contatos, visualizar hist√≥rico de visitas e remover pessoas da lista.</p>
        </div>

        <div class="card">
          <h3>üïí Lan√ßar</h3>
          <p class="text-muted small">Use esta aba para registrar manualmente atividades j√° realizadas:</p>
          <ul class="help-list">
            <li><strong>Data:</strong> Selecione o dia da atividade</li>
            <li><strong>Dura√ß√£o:</strong> Informe horas e minutos trabalhados</li>
            <li><strong>Modalidades:</strong> Marque as atividades realizadas (voc√™ pode selecionar v√°rias)</li>
            <li><strong>Observa√ß√µes:</strong> Campo opcional para anota√ß√µes</li>
          </ul>
          <p class="text-muted small">‚ö†Ô∏è <strong>Importante:</strong> Ao selecionar Revisitas ou Estudos, escolha a pessoa e confirme se houve contato (mesma l√≥gica do cron√¥metro).</p>
        </div>

        <div class="card">
          <h3>üì§ Relat√≥rio</h3>
          <p class="text-muted small">Visualize e gerencie seus relat√≥rios mensais:</p>
          <ul class="help-list">
            <li><strong>Selecionar m√™s:</strong> Use os bot√µes "‚óÄÔ∏è" e "‚ñ∂Ô∏è" para navegar entre meses</li>
            <li><strong>Resumo:</strong> Veja total de horas, publica√ß√µes, v√≠deos, revisitas, estudos e observa√ß√µes</li>
            <li><strong>Detalhes:</strong> Clique em "üìã Ver lan√ßamentos" para ver todos os registros do m√™s</li>
            <li><strong>Editar:</strong> Clique no √≠cone de l√°pis ‚úèÔ∏è para modificar um lan√ßamento</li>
            <li><strong>Excluir:</strong> Clique no √≠cone de lixeira üóëÔ∏è para remover um lan√ßamento</li>
            <li><strong>Enviar:</strong> Clique em "üì§ Enviar Relat√≥rio" para gerar um e-mail pr√©-preenchido para seu anci√£o</li>
          </ul>
          <p class="text-muted small">üí° <strong>Dica:</strong> Os dados s√£o salvos automaticamente na nuvem se voc√™ estiver logado!</p>
        </div>

        <div class="card">
          <h3>‚öôÔ∏è Configura√ß√µes</h3>
          <p class="text-muted small">Personalize o aplicativo de acordo com suas necessidades:</p>
          <ul class="help-list">
            <li><strong>Dados pessoais:</strong> Nome e congrega√ß√£o</li>
            <li><strong>Tipo de servi√ßo:</strong> Publicador, Pioneiro Auxiliar ou Pioneiro Regular (define sua meta de horas)</li>
            <li><strong>Anci√£os:</strong> Adicione os anci√£os que recebem relat√≥rios (usado no envio de e-mail)</li>
          </ul>
        </div>

        <div class="card">
          <h3>‚òÅÔ∏è Sincroniza√ß√£o em Nuvem</h3>
          <p class="text-muted small">Seus dados s√£o automaticamente sincronizados com a nuvem:</p>
          <ul class="help-list">
            <li><strong>Autom√°tica:</strong> Toda altera√ß√£o √© salva instantaneamente na nuvem</li>
            <li><strong>M√∫ltiplos dispositivos:</strong> Acesse seus dados de qualquer lugar (celular, tablet, computador)</li>
            <li><strong>Seguro:</strong> Seus dados s√£o protegidos com autentica√ß√£o por e-mail e senha</li>
          </ul>
          <p class="text-muted small">üí° <strong>Dica:</strong> Funciona offline! As altera√ß√µes s√£o salvas localmente e sincronizadas automaticamente quando voc√™ tiver internet.</p>
        </div>

        <div class="card">
          <h3>üì± Instalar Aplicativo</h3>
          <p class="text-muted small">Este √© um Progressive Web App (PWA) - voc√™ pode instal√°-lo como um app nativo:</p>
          <ul class="help-list">
            <li><strong>Android/iPhone:</strong> Clique em "üì± Instalar" no topo da p√°gina ou no menu do navegador</li>
            <li><strong>Computador:</strong> Use o bot√£o "Instalar" que aparece na barra de endere√ßo ou no menu</li>
            <li><strong>Vantagens:</strong> Acesso r√°pido, notifica√ß√µes, funciona offline e ocupa pouco espa√ßo</li>
          </ul>
        </div>

        <div class="card">
          <h3>üåì Tema Claro/Escuro</h3>
          <p class="text-muted small">Clique no bot√£o üåì no topo para alternar entre tema claro e escuro.</p>
        </div>

        <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-align: center;">
          <h3 style="color: white;">üí¨ Precisa de mais ajuda?</h3>
          <p style="color: rgba(255,255,255,0.9);">Se tiver d√∫vidas ou sugest√µes, entre em contato com o desenvolvedor.</p>
        </div>
      </section>
    </main>

    <!-- NAV BOTTOM -->
    <nav class="bottom-nav" id="bottom-nav">
      <button class="nav-button active" data-nav="dashboard">üè†<span>In√≠cio</span></button>
      <button class="nav-button" data-nav="lancamento">üïí<span>Lan√ßar</span></button>
      <button class="nav-button" data-nav="revisitas">üîÅ<span>Revisitas</span></button>
      <button class="nav-button" data-nav="estudos">üìñ<span>Estudos</span></button>
      <button class="nav-button" data-nav="relatorio">üì§<span>Relat√≥rio</span></button>
      <button class="nav-button" data-nav="ajuda">‚ùì<span>Ajuda</span></button>
      <button class="nav-button" data-nav="config">‚öôÔ∏è<span>Config</span></button>
    </nav>

    <!-- MODALS -->
    <!-- Modal Timer Modalidades -->
    <div id="modal-timer" class="modal hidden">
      <div class="modal-content">
        <h3>Selecione as modalidades</h3>
        <p class="text-muted small">Voc√™ pode selecionar mais de uma modalidade</p>
        <div id="modalidades-checkbox-list" class="checkbox-list"></div>
        <div class="modal-actions">
          <button id="btn-cancel-timer" class="btn-secondary">Cancelar</button>
          <button id="btn-confirm-timer" class="btn-primary">Iniciar</button>
        </div>
      </div>
    </div>

    <!-- Modal Cron√¥metro Ativo -->
    <div id="modal-cronometro" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header-with-close">
          <h3>Servi√ßo em andamento</h3>
          <button id="btn-minimize-timer" class="btn-close" title="Minimizar">‚úï</button>
        </div>
        <div class="cronometro-display">
          <div id="cronometro-tempo" class="cronometro-tempo">00:00:00</div>
          <div class="cronometro-info">
            <p class="text-muted small" id="cronometro-inicio"></p>
            <p class="text-muted small" id="cronometro-modalidades"></p>
          </div>
        </div>
        <div class="modal-actions">
          <button id="btn-pause-timer" class="btn-secondary">Pausar</button>
          <button id="btn-stop-timer" class="btn-primary">Finalizar</button>
        </div>
      </div>
    </div>

    <!-- Modal Cadastrar Nova Revisita -->
    <div id="modal-add-revisita" class="modal hidden">
      <div class="modal-content">
        <h3>Nova revisita</h3>
        <form id="form-add-revisita" class="form">
          <label>
            Nome *
            <input type="text" id="revisita-nome" required />
          </label>
          <label>
            Endere√ßo
            <input type="text" id="revisita-endereco" />
          </label>
          <label>
            Telefone
            <input type="tel" id="revisita-telefone" />
          </label>
          <label>
            Publica√ß√£o deixada
            <input type="text" id="revisita-publicacao" />
          </label>
          <label>
            Assunto conversado
            <textarea id="revisita-assunto" rows="3"></textarea>
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-add-revisita" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Registrar Revisita -->
    <div id="modal-registrar-revisita" class="modal hidden">
      <div class="modal-content">
        <h3>Registrar revisita</h3>
        <div id="lista-revisitas-select" class="select-list"></div>
      </div>
    </div>

    <!-- Modal Observa√ß√µes Revisita -->
    <div id="modal-obs-revisita" class="modal hidden">
      <div class="modal-content">
        <h3 id="modal-obs-titulo">Registrar visita</h3>
        <form id="form-obs-revisita">
          <label>
            Data
            <input type="date" id="obs-data" required />
          </label>
          <label>
            Observa√ß√µes
            <textarea id="obs-texto" rows="3" placeholder="Anota√ß√µes sobre a visita..."></textarea>
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-obs-revisita" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Cadastrar Novo Estudo -->
    <div id="modal-add-estudo" class="modal hidden">
      <div class="modal-content">
        <h3>Novo estudo b√≠blico</h3>
        <form id="form-add-estudo" class="form">
          <label>
            Nome do estudante *
            <input type="text" id="estudo-nome" required />
          </label>
          <label>
            Endere√ßo
            <input type="text" id="estudo-endereco" />
          </label>
          <label>
            Telefone
            <input type="tel" id="estudo-telefone" />
          </label>
          <label>
            Dia e hor√°rio
            <input type="text" id="estudo-diahora" placeholder="Ex.: S√°bado 15h" />
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-add-estudo" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Registrar Estudo -->
    <div id="modal-registrar-estudo" class="modal hidden">
      <div class="modal-content">
        <h3>Registrar estudo</h3>
        <div id="lista-estudos-select" class="select-list"></div>
      </div>
    </div>

    <!-- Modal Observa√ß√µes Estudo -->
    <div id="modal-obs-estudo" class="modal hidden">
      <div class="modal-content">
        <h3 id="modal-obs-estudo-titulo">Registrar estudo</h3>
        <form id="form-obs-estudo">
          <label>
            Data
            <input type="date" id="obs-estudo-data" required />
          </label>
          <label>
            Observa√ß√µes
            <textarea id="obs-estudo-texto" rows="3" placeholder="Anota√ß√µes sobre o estudo..."></textarea>
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-obs-estudo" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Hist√≥rico Revisita -->
    <div id="modal-historico-revisita" class="modal hidden">
      <div class="modal-content modal-large">
        <h3 id="historico-revisita-nome">Hist√≥rico</h3>
        <div id="historico-revisita-lista" class="historico-lista"></div>
        <div class="modal-actions">
          <button id="btn-mover-estudo" class="btn-secondary">Mover para Estudos</button>
          <button id="btn-fechar-historico-revisita" class="btn-primary">Fechar</button>
        </div>
      </div>
    </div>

    <!-- Modal Hist√≥rico Estudo -->
    <div id="modal-historico-estudo" class="modal hidden">
      <div class="modal-content modal-large">
        <h3 id="historico-estudo-nome">Hist√≥rico</h3>
        <div id="historico-estudo-lista" class="historico-lista"></div>
        <div class="modal-actions">
          <button id="btn-fechar-historico-estudo" class="btn-primary">Fechar</button>
        </div>
      </div>
    </div>

    <!-- Modal Selecionar Revisita (para lan√ßamento/timer) -->
    <div id="modal-selecionar-revisita" class="modal hidden">
      <div class="modal-content">
        <h3>Selecione a revisita</h3>
        <div id="lista-selecao-revisitas" class="select-list"></div>
        <div class="modal-actions">
          <button id="btn-nova-revisita-rapida" class="btn-primary">+ Nova revisita</button>
          <button id="btn-cancel-selecionar-revisita" class="btn-secondary">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal Cadastro R√°pido Revisita -->
    <div id="modal-rapido-revisita" class="modal hidden">
      <div class="modal-content">
        <h3>Cadastro r√°pido - Revisita</h3>
        <form id="form-rapido-revisita" class="form">
          <label>
            Nome *
            <input type="text" id="rapido-revisita-nome" required />
          </label>
          <label>
            Endere√ßo (opcional)
            <input type="text" id="rapido-revisita-endereco" />
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-rapido-revisita" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Selecionar Estudo (para lan√ßamento/timer) -->
    <div id="modal-selecionar-estudo" class="modal hidden">
      <div class="modal-content">
        <h3>Selecione o estudo</h3>
        <div id="lista-selecao-estudos" class="select-list"></div>
        <div class="modal-actions">
          <button id="btn-novo-estudo-rapido" class="btn-primary">+ Novo estudo</button>
          <button id="btn-cancel-selecionar-estudo" class="btn-secondary">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal Cadastro R√°pido Estudo -->
    <div id="modal-rapido-estudo" class="modal hidden">
      <div class="modal-content">
        <h3>Cadastro r√°pido - Estudo</h3>
        <form id="form-rapido-estudo" class="form">
          <label>
            Nome do estudante *
            <input type="text" id="rapido-estudo-nome" required />
          </label>
          <label>
            Dia/hor√°rio (opcional)
            <input type="text" id="rapido-estudo-diahora" placeholder="Ex.: S√°bado 15h" />
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-rapido-estudo" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Configurar Meta -->
    <div id="modal-meta" class="modal hidden">
      <div class="modal-content">
        <h3>Configurar meta</h3>
        <form id="form-modal-meta">
          <label>
            Voc√™ est√° atuando como:
            <select id="meta-tipo-servico" required>
              <option value="publicador">Publicador</option>
              <option value="auxiliar">Pioneiro Auxiliar</option>
              <option value="regular">Pioneiro Regular</option>
            </select>
          </label>
          <div id="meta-fields"></div>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-meta" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Adicionar Anci√£o -->
    <div id="modal-add-anciao" class="modal hidden">
      <div class="modal-content">
        <h3>Adicionar anci√£o</h3>
        <form id="form-add-anciao" class="form">
          <label>
            Nome *
            <input type="text" id="anciao-nome" required />
          </label>
          <label>
            WhatsApp (com DDD) *
            <input type="tel" id="anciao-telefone" placeholder="5599999999999" required />
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-add-anciao" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Adicionar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Selecionar Anci√£o -->
    <div id="modal-selecionar-anciao" class="modal hidden">
      <div class="modal-content">
        <h3>Enviar relat√≥rio para:</h3>
        <div id="lista-anciaos-select" class="select-list"></div>
        <div class="modal-actions">
          <button id="btn-cancel-selecionar-anciao" class="btn-secondary">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- MODAL: Informa√ß√µes adicionais (publica√ß√µes, revisitas abertas, cartas) -->
    <div id="modal-info-adicional" class="modal hidden">
      <div class="modal-content">
        <h3>Informa√ß√µes adicionais</h3>
        <form id="form-info-adicional" class="form">
          <label>
            Publica√ß√µes colocadas
            <input type="number" id="info-publicacoes" min="0" value="0" />
          </label>
          <label>
            Revisitas abertas
            <input type="number" id="info-revisitas-abertas" min="0" value="0" />
          </label>
          <label>
            Cartas escritas
            <input type="number" id="info-cartas" min="0" value="0" />
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-info-adicional" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Confirmar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- MODAL: Editar lan√ßamento -->
    <div id="modal-editar-lancamento" class="modal hidden">
      <div class="modal-content">
        <h3>Editar lan√ßamento</h3>
        <form id="form-editar-lancamento" class="form">
          <input type="hidden" id="edit-lan-id" />
          <label>
            Data
            <input type="date" id="edit-lan-data" required />
          </label>
          <div class="grid grid-2">
            <label>
              Horas
              <input type="number" id="edit-lan-horas" min="0" value="0" required />
            </label>
            <label>
              Minutos
              <input type="number" id="edit-lan-minutos" min="0" max="59" value="0" required />
            </label>
          </div>
          <label>
            Modalidade
            <input type="text" id="edit-lan-modalidade" required readonly />
          </label>
          <label>
            Publica√ß√µes colocadas
            <input type="number" id="edit-lan-publicacoes" min="0" value="0" />
          </label>
          <label>
            Revisitas abertas
            <input type="number" id="edit-lan-revisitas-abertas" min="0" value="0" />
          </label>
          <label>
            Cartas escritas
            <input type="number" id="edit-lan-cartas" min="0" value="0" />
          </label>
          <label>
            Observa√ß√µes
            <textarea id="edit-lan-obs" rows="2"></textarea>
          </label>
          <div class="modal-actions">
            <button type="button" id="btn-cancel-editar-lancamento" class="btn-secondary">Cancelar</button>
            <button type="submit" class="btn-primary">Salvar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, updateDoc, deleteDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBkKDnPUPyxESjsDpQDqFcqoytD472x76U",
      authDomain: "relatoriodecampov2.firebaseapp.com",
      projectId: "relatoriodecampov2",
      storageBucket: "relatoriodecampov2.firebasestorage.app",
      messagingSenderId: "716210337206",
      appId: "1:716210337206:web:d352d9a9a008413a537d17"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Exportar para uso global
    window.firebaseApp = app;
    window.firebaseAuth = auth;
    window.firebaseDb = db;
    window.firebaseAuthMethods = {
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      onAuthStateChanged,
      signOut
    };
    window.firebaseDbMethods = {
      doc,
      setDoc,
      getDoc,
      collection,
      query,
      where,
      getDocs,
      updateDoc,
      deleteDoc,
      onSnapshot
    };
  </script>

  <script src="js/firebase-sync.js"></script>
  <script src="js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>
